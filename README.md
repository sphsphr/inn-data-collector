# inn-data-collector

### Автоматизированный сбор данных о банкротствах компаниий по ИНН из государственных источников

[![Python](https://img.shields.io/badge/Python-3.9+-blue?logo=python)](https://python.org)

## Возможности
- Парсинг ИНН используя **Федресурс** (банкротства)
- Получение информации о делах банкротства с **Кад.Арбитр**
- Добыча подробной информации с помощью API **DaData**
- Автоматическое сохранение полученных данных в базу данных **SQLite** 
- Генерация PDF-файлов веб-страниц

## Технологии

+ Selenium
+ SQLAlchemy
+ Pandas (для обработки Excel)

## Установка

1. Клонируем репозиторий:
```
git clone https://github.com/sphsphr/inn-data-collector.git
cd inn-data-collector
```
2.  Устанавливаем зависимости:
```
pip install -r requirements.txt
```
## Запуск
В коде есть переменные, которые можно изменять:
```
class Config:
    # API TOKEN dadata.ru
    API_TOKEN = "<ВАШ_API>"

    # Путь для сохранения PDF
    PDF_OUTPUT_DIR = os.path.join(os.getcwd(), "REPORTS")

    # Настройки базы данных
    DB_URL = "sqlite:///test_db.sqlite"

    # Настройки Selenium
    SELENIUM_WINDOW_SIZE = (1240, 1080)
    SELENIUM_TIMEOUT = 10

    # Настройки логирования
    LOG_FILE = "last_run_log.log"
    LOG_LEVEL = logging.INFO
```
Для корректной работы скрипта нужен список ИНН в Excel таблице (.xlsx).

Имя столбца должно быть - ИНН.

![image](https://github.com/user-attachments/assets/01f6e464-296d-41bd-bd52-7ed038e6f439)
1. Запускаем скрипт:
```
python main.py
```
2. После запуска нужно указать путь к файлу:
```
Укажите путь к Excel таблице из сетевой или обычной папки(например \\MAX\Users\crysi\inn_table\inn_table2.xlsx):
```

## Как устроен процесс
### Входные данные

На вход скрипту даётся путь к файлу - **Excel** таблица со столбцом ИНН, вытаскиваем данные при помощи **Pandas**.

### Selenium

Для сбора данных об ИНН используются возможности библиотеки **Selenium**.
Робот проходится по всем валидным ИНН и собирает по ним данные с сайтов **fedresurs.ru**, **kad.arbitr.ru**.


### Requests

Для сайта **dadata.ru** используется библиотека **requests**.
Обращаемся к API dadata.ru используя выданный после регистрации на сайте API KEY.

### База данных, SQLAlchemy

При запуске скрипта создается реляционная база данных **SQLite** при помощи библиотеки **SQLAlchemy**.
Сначала идет сбор всех нужных данных при помощи **Selenium**, далее используется **SQLAlchemy** для отправки данных в БД.
Если в БД уже была информация о текущем проверяемом ИНН, то старая информация удаляется и добавляется новая.

### Логирование

При помощи **logging** процесс выполнения скрипта записывается в .log файл для дальнейшего анализа и отслеживания выполнения.

## Структура
```
/inn-data-collector
│
├── main.py                # Основной скрипт
├── test_db.sqlite         # База данных, создается скриптом, если по указанному пути её нет
├── inn_table.xlsx         # Образец, набор с номерами ИНН
├── requirements.txt       # Зависимости
├── README.md             
└── /REPORTS               # Директория сохранения страниц в .pdf, создается скриптом, если её нет
    ├── <номер инн2>.pdf   # Примеры выходных данных
    └── <номер инн1>.pdf    
```
## Потенциальное развитие проекта
1. Улучшенное логирование
2. Сайт **kad.arbitr.ru** всячески борется с ботами, например блокируя изначальные настройки Selenium Webdriver, а также сильно ограничивает количество запросов, поэтому нужна работа с прокси, cookie-файлами и настройками Webdriver для обхода ограничений
3. Расширение структуры БД
4. Расширение вариантов Exceptions
5. Реализовать GUI
6. Многопоточность
